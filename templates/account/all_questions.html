{% extends 'account/main.html' %}

{% block content %}

<div class="all-blogs">
    <div class="empty"></div>
    <div class="blogs-links">
        <div class="all-blogs-link">
            <a href="{% url 'all_blogposts' %}" title="See all blog posts"><h2><i class="fa-solid fa-angles-right"></i> All Blog-Posts  <i class="fa-solid fa-blog"></i></h2></a>
        </div>
    </div>
</div>


<div class="all-blogposts-container">
    <div class="all-blogposts-header">
        <div class="home-link"><a href="{% url 'home' %}"><h3><i class="fa-solid fa-angles-left"></i> Home <i class="fa-solid fa-house"></i></h3></a></div>
        <div class="all-blogposts-start"><h1>All Questions</h1></div>
    </div>
    {% if request.user.is_authenticated %}
        {% for question, upvotable, downvotable,comments in questions_votes %}
        {% if question.user|isCoordinator %}
            <div class="blogpost-container coordinator">
                <div class="blogpost-header">
                    <div class="blogpost-title-header">
                        <div class="blogpost-title"><h1>{{ question.title }}</h1></div>
                        {% if question.importance == 'High' %}
                        <div class="blogpost-importance" title="High Importance Post"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>
                        {% endif %}
                        {% if question.importance == 'Medium' %}
                        <div class="blogpost-importance" title="Medium Importance Post"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-regular fa-star"></i></div>
                        {% endif %}
                        {% if question.importance == 'Low' %}
                        <div class="blogpost-importance" title="Low Importance Post"><i class="fa-solid fa-star"></i><i class="fa-regular fa-star"></i><i class="fa-regular fa-star"></i></div>
                        {% endif %}
                    </div>
                    <div class="blogpost-time"><i>{{ question.updated_time }}</i></div>
                </div>
                <div class="blogpost-body">
                    <div class="blogpost-content"><p>{{ question.content }}</p></div>
                </div>
                <div class="blogpost-footer">
                    {% if request.user.username == question.user.username %}
                    <div class="blogpost-username"><h4><i class="fa-solid fa-circle-right"></i> You</h4></div>
                    {% else %}
                    <div class="blogpost-username"><h4><a href="{% url 'profile' question.id %}"><i class="fa-solid fa-circle-right"></i> @<u>{{ question.user.username }} (Co)</u></a></h4></div>
                    {% endif %}
                    <div class="blogpost-votes">
                        <div class="blogpost-upvotes">
                            {% if upvotable %}
                            <div class="blogpost-upvote-link">
                                <a href="{% url 'upvote' question.id %}" title="Like"><i class="fa-regular fa-thumbs-up thumbs"></i></a>
                            </div>
                            {% else %}
                            <div class="blogpost-upvote-link">
                                <i class="fa-solid fa-thumbs-up thumbs" title="Liked"></i>
                            </div>
                            {% endif %}
                            <div class="blogpost-upvote-count">{{ question.upvotes }}</div>
                        </div>
                        <div class="blogpost-downvotes">
                            {% if downvotable %}
                            <div class="blogpost-downvote-link">
                                <a href="{% url 'downvote' question.id %}" title="Dislike"><i class="fa-regular fa-thumbs-down thumbs"></i></a>
                            </div>
                            {% else %}
                            <div class="blogpost-downvote-link">
                                <i class="fa-solid fa-thumbs-down thumbs" title="Disliked"></i>
                            </div>
                            {% endif %}
                            <div class="blogpost-downvote-count">{{ question.downvotes }}</div>
                        </div>
                    </div>
                </div>

                <div class="view-replies">
                    <h3><i class="fa-regular fa-comment"></i> Replies <i class="fa-solid fa-caret-down down-btn"></i><i class="fa-solid fa-caret-up up-btn hide"></i></h3>
                </div>

                <div class="posted-comments">

                    {% for comment in comments %}

                    {% if comment.user == request.user %}

                    <div class="comment-items right-align">
                        
                        <div class="align-comment">
                            <div class="comment-username"><h4><i class="fa-solid fa-arrow-turn-up"></i> Reply by you</h4></div>
                            <div class="comment-content-block">
                                <div class="comment-content"> {{comment.content}}</div>
                                <div class="comment-delete"><a href="{% url 'delete-comment' comment.id %} " onclick="return confirm('Are you sure you want to delete this comment?');"><h2><i class="fa-solid fa-trash-can"></i></h2></a></div>
                            </div>
                            <div class="comment-date"><i>{{comment.date}}</i></div>
                        </div>

                    </div>

                    {% else %}

                    <div class="comment-items left-align">

                        <div class="align-comment">
                            <div class="comment-username"><h4><i class="fa-solid fa-arrow-turn-down"></i> Reply from {{comment.user.username}}</h4></div>
                            <div class="comment-content-block">
                                <div class="comment-content"> {{comment.content}}</div>
                            </div>
                            <div class="comment-date"><i>{{comment.date}}</i></div>
                        </div>

                    </div>

                    {% endif %}

                    {% endfor %}

                </div>


                {% if request.user|isCoordinator %}

                <div class="comment-form">
                    <form action="{% url 'post-comment' question.id %}" method="POST">

                        {% csrf_token %}

                        <div class="comment-form-block">
                            <div class="comment-form-item">
                                <input type="text" name="comment" placeholder="Reply" required id="id_comment">
                            </div>
                            <div class="comment-form-btn">
                                <button type="submit"><h3>Send</h3></button>
                            </div>
                        </div>
                    </form>
                </div>

                {% endif %}

            </div>
        {% endif %}
        {% if question.user|isStudent %}
            <div class="blogpost-container">
                <div class="blogpost-header">
                    <div class="blogpost-title-header">
                        <div class="blogpost-title"><h1>{{ question.title }}</h1></div>
                    </div>
                    <div class="blogpost-time"><i>{{ question.updated_time }}</i></div>
                </div>
                <div class="blogpost-body">
                    <div class="blogpost-content"><p>{{ question.content }}</p></div>
                </div>
                <div class="blogpost-footer">
                    {% if request.user.username == question.user.username %}
                    <div class="blogpost-username"><h4><i class="fa-solid fa-circle-right"></i> You</h4></div>
                    {% else %}
                    <div class="blogpost-username"><h4><a href="{% url 'profile' question.id %}"><i class="fa-solid fa-circle-right"></i> @<u>{{ question.user.username }}</u></a></h4></div>
                    {% endif %}
                    <div class="blogpost-votes">
                        <div class="blogpost-upvotes">
                            {% if upvotable %}
                            <div class="blogpost-upvote-link">
                                <a href="{% url 'upvote' question.id %}" title="Like"><i class="fa-regular fa-thumbs-up thumbs"></i></a>
                            </div>
                            {% else %}
                            <div class="blogpost-upvote-link">
                                <i class="fa-solid fa-thumbs-up thumbs" title="Liked"></i>
                            </div>
                            {% endif %}
                            <div class="blogpost-upvote-count">{{ question.upvotes }}</div>
                        </div>
                        <div class="blogpost-downvotes">
                            {% if downvotable %}
                            <div class="blogpost-downvote-link" title="Dislike">
                                <a href="{% url 'downvote' question.id %}"><i class="fa-regular fa-thumbs-down thumbs"></i></a>
                            </div>
                            {% else %}
                            <div class="blogpost-downvote-link">
                                <i class="fa-solid fa-thumbs-down thumbs" title="Disliked"></i>
                            </div>
                            {% endif %}
                            <div class="blogpost-downvote-count">{{ question.downvotes }}</div>
                        </div>
                    </div>
                </div>

                    <div class="view-replies">
                        <h3><i class="fa-regular fa-comment"></i> Replies <i class="fa-solid fa-caret-down down-btn"></i><i class="fa-solid fa-caret-up up-btn hide"></i></h3>
                    </div>
                
                <div class="posted-comments">

                    {% for comment in comments %}

                    {% if comment.user == request.user %}

                    <div class="comment-items right-align">
                        
                        <div class="align-comment">
                            <div class="comment-username"><h4><i class="fa-solid fa-arrow-turn-up"></i> Reply by you</h4></div>
                            <div class="comment-content-block">
                                <div class="comment-content"> {{comment.content}}</div>
                                <div class="comment-delete"><a href="{% url 'delete-comment' comment.id %} " onclick="return confirm('Are you sure you want to delete this comment?');"><h2><i class="fa-solid fa-trash-can"></i></h2></a></div>
                            </div>
                            <div class="comment-date"><i>{{comment.date}}</i></div>
                        </div>

                    </div>

                    {% else %}

                    <div class="comment-items left-align">

                        <div class="align-comment">
                            <div class="comment-username"><h4><i class="fa-solid fa-arrow-turn-down"></i> Reply from {{comment.user.username}}</h4></div>
                            <div class="comment-content-block">
                                <div class="comment-content"> {{comment.content}}</div>
                            </div>
                            <div class="comment-date"><i>{{comment.date}}</i></div>
                        </div>

                    </div>

                    {% endif %}

                    {% endfor %}

                </div>

                {% if request.user == question.user or request.user|isCoordinator %}

                <div class="comment-form">
                    <form action="{% url 'post-comment' question.id %}" method="POST">

                        {% csrf_token %}

                        <div class="comment-form-block">
                            <div class="comment-form-item">
                                <input type="text" name="comment" placeholder="Reply" required id="id_comment">
                            </div>
                            <div class="comment-form-btn">
                                <button type="submit"><h3>Send</h3></button>
                            </div>
                        </div>
                    </form>
                </div>

                {% endif %}
            </div>
        {% endif %}
        {% endfor %}
        <div class="note">
            <p><b>Note: </b>Post Titles having stars signifies the 'Low'/ 'Medium'/ 'High' importance of the post by Coordinator.</p>
        </div>
    {% else %}
        {% for question,comments in question_comments.items %}
            <div class="blogpost-container">
                <div class="blogpost-header">
                    <div class="blogpost-title"><h1>{{ question.title }}</h1></div>
                    <div class="blogpost-time"><i>{{ question.updated_time }}</i></div>
                </div>
                <div class="blogpost-body">
                    <div class="blogpost-content"><p>{{ question.content }}</p></div>
                </div>
                <div class="blogpost-footer">
                    <div class="blogpost-username"><h4>posted by {{ question.user.username }}</h4></div>
                    
                    <div class="blogpost-votes">
                        <div class="blogpost-upvotes">
                            <div class="blogpost-upvotes-text">
                                <h4>Upvotes</h4>
                            </div>
                            <div class="blogpost-upvote-count">{{ question.upvotes }}</div>
                        </div>
                        <div class="blogpost-downvotes">
                            <div class="blogpost-downvotes-text">
                                <h4>Downvotes</h4>
                            </div>
                            <div class="blogpost-downvote-count">{{ question.downvotes }}</div>
                        </div>
                    </div>
                </div>

                <div class="view-replies">
                    <h3><i class="fa-regular fa-comment"></i> Replies <i class="fa-solid fa-caret-down down-btn"></i><i class="fa-solid fa-caret-up up-btn hide"></i></h3>
                </div>

                <div class="posted-comments">
                    {% for comment in comments %}

                    <div class="comment-items left-align">
                        <div class="align-comment">
                            <div class="comment-username"><h3><i class="fa-solid fa-arrow-turn-down"></i> Reply from xxxx </h3></div>
                            <div class="comment-content-block">
                                <div class="comment-content"> {{comment.content}}</div>
                            </div>
                            <div class="comment-date"><i>{{comment.date}}</i></div>
                        </div>
                    </div>

                    {% endfor %}

                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

{% endblock %}